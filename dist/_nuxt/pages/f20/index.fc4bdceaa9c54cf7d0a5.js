webpackJsonp([0],{ChRw:function(t,e,s){"use strict";var i=s("tWp3"),n=s("vI4T"),r=s("VU/8")(i.a,n.a,!1,null,null,null);r.options.__file="components/f20list.vue",e.a=r.exports},KbK8:function(t,e,s){"use strict";var i=s("VJR+"),n=s("fZS/"),r=s("VU/8")(i.a,n.a,!1,null,null,null);r.options.__file="components/f20.vue",e.a=r.exports},"VJR+":function(t,e,s){"use strict";e.a={props:["width","mode","item"],data:function(){return{currentImage:void 0,configKonva:{width:"front"===this.mode?552:659,height:233},configBackground:{x:0,y:0,image:new Image,width:"front"===this.mode?552:659,height:233},numberImages:{},backgroundReady:!1,offsets:[0,43,0,0,21,45,80,112]}},created:function(){this._name="f20_"+this.mode,this.setBackground()},updated:function(){this.generateImage()},mounted:function(){var t=this;this.isFront&&[].concat(function(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}(Array(10).keys())).forEach(function(e){var s=new Image;s.src=t.$sprites.numbers[e],t.numberImages[e]=s})},computed:{height:function(){return Math.round(this.width/(this.isFront?2.37:2.92))},scale:function(){return this.width/(this.isFront?552:659)},isFront:function(){return"front"===this.mode},parsedIndex:function(){return this.item.index?this.item.index.split(""):[]}},methods:{generateImage:function(){var t=this,e=this.$refs["layer-"+this.mode];e&&e.getStage().toImage({width:"front"===t.mode?552:659,height:233,mimeType:"image/png",callback:function(e){t.currentImage=e,t.$refs["f20"+t._uid].children[0].src=e.src}})},setBackground:function(){this.configBackground.image.src=this.isFront?this.$sprites.f20front:this.$sprites.f20back,this.configBackground.image.onload=function(){this.backgroundReady=!0}.bind(this)}}}},XyzD:function(t,e,s){"use strict";var i=s("KbK8"),n=s("ChRw");e.a={head:{bodyAttrs:{class:"with-print-container"}},middleware:"storage",components:{F20:i.a,F20List:n.a},data:function(){return{reasons:["Иные обстоятельства","Засылка","Заявление пользователя","Заявление отправителя","Отказ адресата от получения","Отсутствие адресата по указанному адресу","Невозможно прочесть адрес адресата","Истек срок хранения"],selectedIndex:"",selectedMode:0,selectedType:1,selectedReason:7,previewFrontWidth:void 0,previewBackWidth:void 0,reasonText:"",selectedOperator:void 0,lists:{front:[],back:[],both:[]},modes:[{text:"Обе части",value:0},{text:"Передняя часть",value:1},{text:"Задняя часть",value:2}],operators:this.$store.getters.selectPeople,scrollBottom:!0}},methods:{deleteFromCurrentList:function(t){this.currentList.splice(t,1)},clearCurrentList:function(){this.currentList.length&&this.currentList.splice(0,this.currentList.length)},getTypeName:function(t){return 0===t?"-":1===t?"Возврат":2===t?"Досыл":void 0},changeType:function(t){this.selectedType!==t&&(this.selectedType=t,this.reasonText="",1!==this.selectedMode&&0!==t&&(this.selectedReason=1===t?7:1))},selectReason:function(t){this.selectedReason=t,0!==t&&(this.reasonText="")},getReasonText:function(t){return t.hasOwnProperty("reason")?0===t.reason?t.reasonText||"-":this.reasons[t.reason]:"-"},addToList:function(){2!==this.selectedMode&&this.$refs.indexInputForm.focus(),this.currentList.push(this.getCurrentItemForList()),this.scrollBottom=!0},getFrontDataForList:function(){var t=this.$children.filter(function(t){return"f20_front"===t._name})[0].currentImage;return Object.assign({image_front:t.src},this.getFrontData)},getBackDataForList:function(){var t=this.$children.filter(function(t){return"f20_back"===t._name})[0].currentImage;return Object.assign({image_back:t.src},this.getBackData)},getCurrentItemForList:function(){return 1===this.selectedMode?this.getFrontDataForList():2===this.selectedMode?this.getBackDataForList():0===this.selectedMode?Object.assign(this.getFrontDataForList(),this.getBackDataForList()):void 0},openPrintModal:function(){this.currentList.length&&this.$refs.printModalRef.show()},closePrintModal:function(){this.$refs.printModalRef.hide()}},computed:{getFrontData:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{index:this.selectedIndex||"",type:this.selectedType}},getBackData:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{operator:this.currentOperatorName,reasonText:this.reasonText&&0===this.selectedReason?this.reasonText:"",reason:this.selectedReason,type:this.selectedType}},currentOperatorName:function(){var t=this,e=this.operators.find(function(e){return e.value===t.selectedOperator});return e.value?e.text:""},text:function(){var t="";return this.selectedType&&(t+=1===this.selectedType?"Возврат ":"Досыл "),this.selectedIndex&&2!==this.selectedMode&&(t+="на индекс "+this.selectedIndex+" "),this.selectedType&&(this.selectedReason?t+="по причине "+this.reasons[this.selectedReason]+" ":t+=this.reasonText?"по причине "+this.reasonText+" ":"по причине иных обстоятельств "),this.selectedOperator&&(t+="сотрудником "+this.currentOperatorName),t},currentList:function(){return 0===this.selectedMode?this.lists.both:1===this.selectedMode?this.lists.front:2===this.selectedMode?this.lists.back:void 0}},mounted:function(){this.previewFrontWidth=this.$refs.previewCol.offsetWidth-30<552?this.$refs.previewCol.offsetWidth-30:552,this.previewBackWidth=this.$refs.previewCol.offsetWidth-30<659?this.$refs.previewCol.offsetWidth-30:659},updated:function(){this.scrollBottom&&this.$refs.scrollableDiv&&(this.$refs.scrollableDiv.scrollTop=this.$refs.scrollableDiv.scrollHeight,this.scrollBottom=!1)}}},"fZS/":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{ref:"f20"+t._uid},[s("img",{pre:!0,attrs:{class:"img-fluid"}})]),s("v-stage",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"stage-"+t.mode,attrs:{config:t.configKonva}},[s("v-layer",{ref:"layer-"+t.mode},[s("v-image",{attrs:{config:t.configBackground}}),t.backgroundReady&&t.isFront&&t.parsedIndex.length?t._l(t.parsedIndex,function(e,i){return s("v-image",{key:i+"indexNumbers",attrs:{config:{x:220+53*i,y:0,width:35,height:233,image:t.numberImages[e]}}})}):t._e(),t.backgroundReady?[1!==t.item.type||0===t.item.reason||t.isFront?t._e():s("v-line",{attrs:{config:{stroke:"black",strokeWidth:3,points:[25,41+t.offsets[t.item.reason],30,46+t.offsets[t.item.reason],39,34+t.offsets[t.item.reason]]}}}),2!==t.item.type||0===t.item.reason||t.isFront?t._e():s("v-line",{attrs:{config:{stroke:"black",strokeWidth:3,points:[311,55+t.offsets[t.item.reason],316,60+t.offsets[t.item.reason],325,47+t.offsets[t.item.reason]]}}}),0===t.item.type||t.isFront||0!==t.item.reason?t._e():s("v-line",{attrs:{config:{stroke:"black",strokeWidth:3,points:[55,176,60,181,69,169]}}}),t.item.reasonText&&!t.isFront?s("v-text",{attrs:{config:{x:235,y:164,text:this.item.reasonText,fontSize:15,fontFamily:"Arial",fill:"black",strokeWidth:2}}}):t._e(),t.item.operator&&!t.isFront?s("v-text",{attrs:{config:{x:160,y:195,text:this.item.operator,fontSize:17,fontFamily:"Arial",fill:"black",strokeWidth:2}}}):t._e(),t.item.type&&t.isFront?s("v-line",{attrs:{config:{points:[2===t.item.type?220:335,20,2===t.item.type?320:440,20],stroke:"black",strokeWidth:10}}}):t._e()]:t._e()],2)],1)],1)};i._withStripped=!0;var n={render:i,staticRenderFns:[]};e.a=n},tWp3:function(t,e,s){"use strict";e.a={props:["mode","list"],data:function(){return{images:[],listWidth:1240,listHeight:1754,pdfMaking:!1}},mounted:function(){setTimeout(this.generateImages.bind(this),1e3)},methods:{generateImages:function(){var t=this;this.images=[],this.lists.forEach(function(e,s){var i=t;t.$refs["list-"+s][0].getStage().toImage({width:t.listWidth,height:t.listHeight,mimeType:"image/png",callback:function(t){i.images.push(t),i.printContent(t)}})})},printContent:function(t){if(t){var e=document.createElement("div");e.classList.add("page"),e.appendChild(t),document.getElementById("printContainer").appendChild(e)}},savePdf:function(){var t=this;this.pdfMaking=!0;var e={pageSize:"A2",content:[],pageMargins:[0,0,0,0]};this.images.forEach(function(s,i){e.content.push({columns:[{image:s.src,width:1191}],pageBreak:t.images.length-1===i?void 0:"after"})}),pdfMake.createPdf(e).download("f20list.pdf",function(){return t.pdfMaking=!1})}},computed:{lists:function(){var t=this.list.slice(),e=[];for(t.forEach(function(t){if("string"==typeof t.image_front){var e=new Image;e.src=t.image_front,t.image_front=e}if("string"==typeof t.image_back){var s=new Image;s.src=t.image_back,t.image_back=s}});t.length>=(0===this.mode?8:16);)e.push(t.splice(0,0===this.mode?8:16));return t.length&&e.push(t.splice(0,t.length)),e},formHeight:function(){return Math.floor(this.listHeight/8)},frontWidth:function(){return Math.floor(552*this.formHeight/233)},backWidth:function(){return Math.floor(659*this.formHeight/233)},isFront:function(){return 1===this.mode}},beforeDestroy:function(){document.getElementById("printContainer").innerHTML=""}}},tede:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row"},[s("div",{ref:"previewCol",staticClass:"col-6 border rounded py-4 text-center"},[s("h5",{staticClass:"pb-2"},[t._v("Ввод данных")]),s("div",[s("b-form-radio-group",{attrs:{buttons:"","button-variant":"outline-primary",options:t.modes},model:{value:t.selectedMode,callback:function(e){t.selectedMode=e},expression:"selectedMode"}})],1),s("div",{staticClass:"mt-2"},[s("b-button-group",[s("b-button",{attrs:{variant:1===t.selectedType?"primary":"outline-primary"},on:{click:function(e){t.changeType(1)}}},[t._v("Возврат")]),s("b-button",{attrs:{variant:2===t.selectedType?"primary":"outline-primary"},on:{click:function(e){t.changeType(2)}}},[t._v("  Досыл  ")]),s("b-button",{attrs:{variant:0===t.selectedType?"primary":"outline-primary"},on:{click:function(e){t.changeType(0)}}},[t._v("Без типа")]),s("b-dropdown",{attrs:{disabled:!t.selectedType,variant:"outline-primary",right:"",text:"Причина"}},[2===t.selectedType?[s("b-dropdown-item",{on:{click:function(e){t.selectReason(1)}}},[t._v(t._s(t.reasons[1]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(2)}}},[t._v(t._s(t.reasons[2]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(0)}}},[t._v(t._s(t.reasons[0]))])]:[s("b-dropdown-item",{on:{click:function(e){t.selectReason(3)}}},[t._v(t._s(t.reasons[3]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(4)}}},[t._v(t._s(t.reasons[4]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(5)}}},[t._v(t._s(t.reasons[5]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(6)}}},[t._v(t._s(t.reasons[6]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(7)}}},[t._v(t._s(t.reasons[7]))]),s("b-dropdown-item",{on:{click:function(e){t.selectReason(0)}}},[t._v(t._s(t.reasons[0]))])]],2)],1)],1),s("div",{staticClass:"input-group mt-2",class:{invisible:2===t.selectedMode}},[t._m(0),s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedIndex,expression:"selectedIndex"}],ref:"indexInputForm",staticClass:"form-control",attrs:{autofocus:"",type:"text",maxlength:"6",onkeypress:"return event.charCode >= 48 && event.charCode <= 57"},domProps:{value:t.selectedIndex},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.addToList(e):null},input:function(e){e.target.composing||(t.selectedIndex=e.target.value)}}})]),s("b-input-group",{staticClass:"mt-2",class:{invisible:0===t.selectedType||1===t.selectedMode},attrs:{prepend:"Причина"}},[s("b-form-input",{attrs:{disabled:0!==t.selectedReason,placeholder:0!==t.selectedReason?t.reasons[t.selectedReason]:"Укажите обстоятельства"},model:{value:t.reasonText,callback:function(e){t.reasonText=e},expression:"reasonText"}})],1),s("b-input-group",{class:{invisible:1===t.selectedMode}},[s("b-form-select",{staticClass:"mb-3 mt-2",attrs:{options:t.operators},model:{value:t.selectedOperator,callback:function(e){t.selectedOperator=e},expression:"selectedOperator"}}),s("b-input-group-append",{staticClass:"mb-3 mt-2"},[s("nuxt-link",{attrs:{to:"/settings"}},[s("b-btn",{attrs:{title:"Добавить сотрудника в программу",variant:"outline-success"}},[s("i",{staticClass:"fa fa-fw fa-plus"})])],1)],1)],1),s("div",{staticClass:"mt-2"},[s("button",{staticClass:"btn btn-success w-100 ",on:{click:function(e){t.addToList()}}},[t._v("Добавить в список\n          "),s("i",{staticClass:"fa fa-fw fa-plus-circle"})])]),s("hr"),s("h5",{staticClass:"py-2"},[t._v("Предварительный просмотр")]),s("f20",{directives:[{name:"show",rawName:"v-show",value:2!==t.selectedMode,expression:"selectedMode !== 2"}],attrs:{item:t.getFrontData,mode:"front",width:t.previewFrontWidth}}),s("f20",{directives:[{name:"show",rawName:"v-show",value:1!==t.selectedMode,expression:"selectedMode !== 1"}],attrs:{item:t.getBackData,mode:"back",width:t.previewBackWidth}})],1),s("div",{staticClass:"col-6"},[s("b-modal",{ref:"printModalRef",attrs:{"hide-footer":!0,lazy:!0,size:"xl",centered:!0,id:"printModal"}},[s("div",{staticClass:"w-100",attrs:{slot:"modal-header"},slot:"modal-header"},[s("div",{staticClass:"modal-header border-0"},[s("h5",{staticClass:"modal-title"},[t._v("Листы для печати")]),s("button",{staticClass:"close",attrs:{type:"button",title:"Закрыть окно","data-dismiss":"modal","aria-label":"Close"},on:{click:function(e){t.closePrintModal()}}},[s("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])]),s("f20-list",{attrs:{mode:t.selectedMode,list:t.currentList}})],1),s("div",[s("button",{staticClass:"w-100 btn btn-success",class:{disabled:!t.currentList.length},on:{click:function(e){t.openPrintModal()}}},[t._v("Сформировать листы для печати\n          "),s("i",{staticClass:"fa fa-fw fa-print"})])]),s("div",{ref:"scrollableDiv",staticClass:"scrollable"},[s("table",{staticClass:"table table-striped"},[s("thead",[s("tr",[s("th",{attrs:{scope:"col"}},[t._v("#")]),s("th",{attrs:{scope:"col"}},[t._v("Операция")]),s("th",{attrs:{scope:"col"}},[t._v("Индекс")]),s("th",{attrs:{scope:"col"}},[t._v("Причина")]),s("th",{attrs:{scope:"col"}},[s("button",{staticClass:"btn btn-sm btn-danger",class:{disabled:!t.currentList.length},attrs:{title:"Очистить список"},on:{click:function(e){t.clearCurrentList()}}},[s("i",{staticClass:"fa fa-fw fa-trash"})])])])]),s("tbody",t._l(t.currentList,function(e,i){return s("tr",{key:i+"tableItem"},[s("th",{attrs:{scope:"row"}},[t._v(t._s(i+1))]),s("td",[t._v(t._s(t.getTypeName(e.type)))]),s("td",[t._v(t._s(e.index||"-"))]),s("td",[t._v(t._s(t.getReasonText(e)))]),s("td",[s("button",{staticClass:"btn text-white btn-sm btn-warning",attrs:{title:"Удалить из списка"},on:{click:function(e){t.deleteFromCurrentList(i)}}},[s("i",{staticClass:"fa fa-fw fa-minus-circle"})])])])}))])])],1)])])};i._withStripped=!0;var n={render:i,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"input-group-prepend"},[e("span",{staticClass:"input-group-text",attrs:{id:"basic-addon1"}},[this._v(" Индекс ")])])}]};e.a=n},vI4T:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"text-center mb-3"},[t.images.length?t._e():s("i",{staticClass:"fa fa-fw fa-4x fa-cog fa-spin"}),t.images.length?s("div",{staticClass:"btn-group"},[t._m(0),s("button",{staticClass:"btn btn-primary",class:{disabled:t.pdfMaking},on:{click:function(e){t.savePdf()}}},[t._v("Сохранить документ\n                "),t.pdfMaking?t._e():s("i",{staticClass:"fa fa-fw fa-file-pdf-o"}),t.pdfMaking?s("i",{staticClass:"fa fa-fw fa-spin fa-cog"}):t._e()])]):t._e()]),t.images.length?s("div",{staticClass:"row"},t._l(t.images,function(t,e){return s("div",{key:e+"imageGenerated",staticClass:"col"},[s("img",{staticClass:"img-fluid",attrs:{src:t.src}})])})):t._e(),t._l(t.lists,function(e,i){return s("v-stage",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],key:i+"listStage",ref:"list-"+i,refInFor:!0,attrs:{config:{width:t.listWidth,height:t.listHeight}}},[s("v-layer",[s("v-rect",{attrs:{config:{x:0,y:0,fill:"white",width:t.listWidth,height:t.listHeight}}}),0===t.mode?[t._l(e,function(e,i){return s("v-image",{key:i+"bothFront",attrs:{config:{y:i*t.formHeight,x:0,width:t.frontWidth,height:t.formHeight,image:e.image_front}}})}),t._l(e,function(e,i){return s("v-image",{key:i+"bothBack",attrs:{config:{y:i*t.formHeight,x:t.frontWidth,width:t.backWidth,height:t.formHeight,image:e.image_back}}})})]:t._l(e,function(e,i){return s("v-image",{key:i+"singleMode",attrs:{config:{y:Math.floor(i/2)*t.formHeight,x:i%2!=0?t.isFront?t.frontWidth:t.backWidth:0,width:t.isFront?t.frontWidth:t.backWidth,height:t.formHeight,image:e[t.isFront?"image_front":"image_back"]}}})})],2)],1)})],2)};i._withStripped=!0;var n={render:i,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"btn btn-success",attrs:{onclick:"window.print()"}},[this._v("Печать\n                "),e("i",{staticClass:"fa fa-fw fa-print"})])}]};e.a=n},"vk+X":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("XyzD"),n=s("tede"),r=s("VU/8")(i.a,n.a,!1,null,null,null);r.options.__file="pages/f20/index.vue",e.default=r.exports}});